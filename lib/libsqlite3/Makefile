PACKAGE=lib${LIB}
LIB=		sqlite3
SHLIB_MAJOR=	1
LIBADD+=	m pthread z

SRCS=	sqlite3.c
INCS=	sqlite3.h sqlite3ext.h

SQLITE=	${SRCTOP}/contrib/sqlite3
.PATH:	${SQLITE}

WARNS?=		2
CFLAGS+=	-I${SQLITE} \
		-DUSE_PREAD=1 \
		-DSTDC_HEADERS=1 \
		-DHAVE_SYS_TYPES_H=1 \
		-DHAVE_SYS_STAT_H=1 \
		-DHAVE_STDLIB_H=1 \
		-DHAVE_STRING_H=1 \
		-DHAVE_MEMORY_H=1 \
		-DHAVE_STRINGS_H=1 \
		-DHAVE_INTTYPES_H=1 \
		-DHAVE_STDINT_H=1 \
		-DHAVE_UNISTD_H=1 \
		-DHAVE_DLFCN_H=1 \
		-DHAVE_USLEEP=1 \
		-DHAVE_LOCALTIME_R=1 \
		-DHAVE_GMTIME_R=1 \
		-DHAVE_DECL_STRERROR_R=1 \
		-DHAVE_STRERROR_R=1 \
		-DHAVE_POSIX_FALLOCATE=1 \
		-D_REENTRANT=1 -DREENTRANT=1 \
		-DSQLITE_THREADSAFE=1 \
		-DSQLITE_OS_UNIX=1 \
		-DSQLITE_ENABLE_RTREE=1 \
		-DSQLITE_ENABLE_FTS3 \
		-DSQLITE_ENABLE_FTS5 -DSQLITE_ENABLE_FTS4 \
		-DSQLITE_ENABLE_JSON1 -DSQLITE_ENABLE_GEOPOLY \
		-DSQLITE_HAVE_ZLIB -DSQLITE_ENABLE_MATH_FUNCTIONS

MK_MAN=	no

.if !defined(COMPAT_32BIT)
afterinstall: 
	${INSTALL} ${SHLINSTALLFLAGS} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
	    ${_INSTALLFLAGS} ${SQLITE}/sqlite3.pc ${DESTDIR}/usr/libdata/pkgconfig/sqlite3.pc
.endif

.if ${MACHINE_ARCH} == "powerpc64le"
CFLAGS+=	-DSQLITE_BYTEORDER=1234
.endif

.include <bsd.lib.mk>
