# $MidnightBSD: src/lib/libz/Makefile,v 1.2 2010/03/21 20:01:16 laffer1 Exp $
# $FreeBSD: src/lib/libz/Makefile,v 1.17 2005/06/03 15:25:13 imp Exp $
#

LIB=		z
SHLIBDIR?=	/lib
MAN=		zlib.3

#CFLAGS+=	-DMAX_WBITS=14 -DMAX_MEM_LEVEL=7
#CFLAGS+=	-g -DDEBUG
#CFLAGS+=	-Wall -Wwrite-strings -Wpointer-arith -Wconversion \
#		-Wstrict-prototypes -Wmissing-prototypes

CFLAGS+=	-DHAS_snprintf -DHAS_vsnprintf -I${.CURDIR}

CLEANFILES+=	example.o example foo.gz minigzip.o minigzip

SRCS = adler32.c compress.c crc32.c uncompr.c deflate.c trees.c \
       zutil.c inflate.c inftrees.c inffast.c zopen.c infback.c gzclose.c \
       gzlib.c gzread.c gzwrite.c zopen.c

.if ${MACHINE_ARCH} == "i386" && ${MACHINE_CPU:M*i686*}
.PATH:		${.CURDIR}/contrib/asm686
SRCS+=		match.S
CFLAGS+=	-DASMV -DNO_UNDERLINE
.endif

.if ${MACHINE_ARCH} == "amd64"
.PATH:		${.CURDIR}/contrib/gcc_gvmat64
SRCS+=		gvmat64.S
CFLAGS+=	-DASMV -DNO_UNDERLINE
.endif

INCS=		zconf.h zlib.h

minigzip:	all minigzip.o
	$(CC) -o minigzip minigzip.o -L. -lz

example:	all example.o
	$(CC) -o example example.o -L. -lz

test: example minigzip
	(export LD_LIBRARY_PATH=. ; ./example )
	(export LD_LIBRARY_PATH=. ; \
		echo hello world | ./minigzip | ./minigzip -d )

.include <bsd.lib.mk>
