#!/bin/sh
#
# $NetBSD: dhclient,v 1.8 2002/03/22 04:33:58 thorpej Exp $
# $FreeBSD: src/etc/rc.d/dhclient,v 1.20.2.1 2005/07/29 23:36:28 brooks Exp $
# $MidnightBSD: src/etc/rc.d/dhclient,v 1.2 2006/08/28 02:47:45 laffer1 Exp $

# PROVIDE: dhclient
# KEYWORD: nojail nostart
# BEFORE: firstboot

. /etc/rc.subr
. /etc/network.subr

name="dhclient"
rcvar=
start_cmd="dhclient_start"
stop_cmd="dhclient_stop"

dhclient_start()
{
	# prevent unnecessicary restarts
	# XXX: should use a pidfile
	if [ -x /usr/bin/pgrep ]; then
		pids=`/usr/bin/pgrep -f "dhclient: $ifn(\$| .*)"`
		if [ -n "$pids" ]; then
			exit 0
		fi
	fi

	if checkyesno background_dhclient; then
		rc_flags="${rc_flags} -b"
	fi

	${dhclient_program} ${rc_flags} $ifn
}

dhclient_stop()
{
	ifconfig $ifn down	# cause dhclient to die
}

ifn="$2"

load_rc_config $name

if ! dhcpif $ifn; then
	return 1
fi

run_rc_command "$1"
