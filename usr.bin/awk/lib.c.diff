$FreeBSD: release/7.0.0/usr.bin/awk/lib.c.diff 170423 2007-06-08 05:44:12Z delphij $

Index: lib.c
===================================================================
RCS file: /home/ncvs/src/contrib/one-true-awk/lib.c,v
retrieving revision 1.1.1.5
diff -u -p -u -r1.1.1.5 lib.c
--- lib.c	5 Jun 2007 15:33:51 -0000	1.1.1.5
+++ lib.c	8 Jun 2007 04:14:51 -0000
@@ -40,7 +40,7 @@ char	*fields;
 int	fieldssize = RECSIZE;
 
 Cell	**fldtab;	/* pointers to Cells */
-char	inputFS[10] = " ";
+char	inputFS[100] = " ";
 
 #define	MAXFLD	2
 int	nfields	= MAXFLD;	/* last allocated slot for $i */
@@ -58,7 +58,7 @@ static Cell dollar1 = { OCELL, CFLD, NUL
 void recinit(unsigned int n)
 {
 	if ( (record = (char *) malloc(n)) == NULL
-	  || (fields = (char *) malloc(n)) == NULL
+	  || (fields = (char *) malloc(n+1)) == NULL
 	  || (fldtab = (Cell **) malloc((nfields+1) * sizeof(Cell *))) == NULL
 	  || (fldtab[0] = (Cell *) malloc(sizeof(Cell))) == NULL )
 		FATAL("out of space for $0 and fields");
